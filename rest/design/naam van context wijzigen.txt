Naam van context wijzigen

0. Als de cursor in een context declaratie geplaatst wordt, sla dan die regel op in een 'huidige regel onder bewerking'.
1. Detecteer het begin van bewerking van de contextnaam in een context declaratie.
	- dat is elke verandering van de regel waardoor de contextnaam verandert.
3. Detecteer dat de gebruiker klaar is met een contextnaam, d.w.z. de cursor bevindt zich niet langer in de naam.


Hoe kan ik deze state bewaren en waar?

Zijn er kant en klare events die ik hiervoor kan gebruiken?
- onchange van Anchor? Een AnchorEvent heeft een oude en nieuwe positie.
	LET OP: 
		1. de anchor wordt alleen bijgewerkt als je iets wijzigt. 
		2. Bovendien, als je de cursor verplaatst, levert het opvragen van de huidige regel een lege string.
		Waarschijnlijk had ik een verkeerd beeld van anchor. Een anchor is een plek waar de tekst kan wijzigen. Dit verschuift door wijzigingen. Maar als je de cursor ergens plaatst, ontstaat daar geen anchor.
- onchangeCursor van selection?
- DocumentEventType heeft twee constructors: Insert en Remove.

Editor.getCursorPosition

NAAMSWIJZIGING CONTEXT
We moeten eerst de vorige versie herstellen om te kijken of de regels vóór mutatie een context declaratie bevatten.
Het namelijk kan zijn dat een paar mutaties verder de regels weer wel een context declaratie bevatten. In dat geval wil je oud en nieuw toch vergelijken. Dus, ja! Het algoritme is dus:
1. Herstel de oorspronkelijke regels waar de mutatie in plaatsvond.
2. Bepaal of de eerste regel een contextdeclaratie is.
	ZOJA:
	- Bij een remove bevindt de cursor zich nu in de contextdeclaratie. De gebruiker is nog niet klaar. Bewaar de oorspronkelijke naam en de regel, die we gebruiken bij de eerstvolgende mutatie waaruit blijkt dat de gebruiker klaar is met naamswijziging.
	- bij een insert van één regel (row(begin) == row(eind)) is de gebruiker nog niet klaar. Idem.
	- Bij een insert van meer dan één regel is de gebruiker klaar met de naamswijziging (if any) van de contextdeclaratie. HERNOEM.
	
	ZONEE:
	- Bij elke andere mutatie: als de positie van de cursor na de operatie niet langer de regel is waarvoor we de naam hebben bewaard. HERNOEM.

HERNOEM EEN CONTEXT:
1. haal de bewaarde, oorspronkelijke naam en zijn regelnummer op.
2. bepaal de nieuwe naam (op de regel waarvoor we een naam hebben bewaard).
3. bepaal de id van de context op basis van de oorspronkelijke naam. Dit kan het parseren van omhullende contexten vergen, omdat we niet perse altijd gekwalificeerde namen hoeven te gebruiken (voor een inline propertydefinitie voor een contexttype kan je volstaan met #<local name>.
4. verander de displaynaam in de nieuwe naam.

OVER POSITIE EN INSERT- EN REMOVE OPERATIES
Positie is zero-based voor zowel rows als columns.
Tekst wordt rechts van de cursor ingevoegd. De cursor wordt achter ingevoegde tekst geplaatst.
Dus als op (0,0) één karakter ingevoegd wordt, is de positie van de cursor daarna (0,1).
Bij een selectie geldt 
	- de positie links van de eerste letter als beginpositie
	- de positie rechts van de laatste letter als eindpositie.

Bij remove staat de cursor oorspronkelijk op de eindpositie en vervolgens op de beginpositie. Alle karakters daartussen in de oorspronkelijke tekst is verwijderd.
Bij insert staat de cursor oorspronkelijk op de beginpositie en vervolgens op de eindpositie. Alle karakters in lines staan tussen die twee posities in de nieuwe tekst.


Zo reconstrueer je de oorspronkelijke waarde van de tekst uit een DocumentEvent:
1. Als tekst verwijderd is: 
	- bij de beginpositie
	- voeg de lines toe
2. Als tekst toegevoegd is:
	- verwijder alles tussen begin- en eindpositie.

Herstellen na remove:
1. getLine ( row(beginpositie) )
2. Splits op col(beginpositie) in a en b
3. prepend lines(0) met a
4. postpend lines(n) met b.
lines is nu de oorspronkelijke tekst.

Herstellen na insert:
1. getLine ( row(beginpositie) ) = lb.
2. verwijder in lb alles na col(beginpositie) (maak een kopie!) = a
3. GetLine ( row(eindpositie) ) = le
4. verwijder in le alles vóór col(eindpositie) = b
5. Oorspronkelijke regel is a + b.