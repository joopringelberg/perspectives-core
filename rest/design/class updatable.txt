class Updatable a where
	applyUpdate :: a -> Delta a -> a

instances: Maybe, Array

propagateDeltas :: Node -> unit
propagateDeltas (Node {deltas, edges}) = $ propagate deltas <$> edges
	where
		propagate (Erbij d) (Edge f target) =  
			let (Node {payload} = f d
			in 
				Erbij payload
		propagate (Eraf d) ...

en nu moeten deze deltas opgeslagen worden bij target.

Maar ik denk dat propagate een functie moet zijn die gedefineerd is op Edge in plaats van een lokale functie bij propagateDeltas.

applyDeltas :: Node -> ...
applyDeltas (Node {payload, deltas}) = voor elke delta: applyUpdate payload delta 
	en dan achtereenvolgens toegepast en uiteindelijk destructief binden in de node.


instance UpdatableMaybe :: Updatable Maybe where
	applyUpdate Just a (Erbij (Just b)) = Just b
	applyUpdate Just a (Eraf (Just a)) = Nothing
	applyUpdate Nothing (Erbij (Just a)) = Just a
	applyUpdate _ _ = Nothing

instance UpdatableArray :: Updatable Array where
	applyUpdate ar (Erbij extra) = ar union extra
	applyUpdate ar (Eraf minus) = ar setDifference minus

Samenvatting.
De class Updatable vat de notie dat een waarde aangepast kan worden met een Delta. Dat pakt voor het soort waarde anders uit: zie de voorbeelden van Maybe en Array, die voor ons het meest relevant zijn.

Vanuit een Node verspreiden we de gecumuleerde deltas (en dat gebeurt pas als alle supports van de Node bijgewerkt zijn). Dat doen we door voor elke Edge van de Node en elke Delta uit de gecumuleerde deltas de functie propagateDelta van Edge toe te passen. Deze past de oorspronkelijke gebonden functie met de gewone Monad bind toe op de inhoud van de Delta (en dat komt overeen met de inhoud van de Node: het kan een Maybe zijn of een Array). Het resultaat is uiteraard weer een Node (NB: voorkom opnieuw netwerk opbouw!). Daaruit pakken we de payload en stoppen die in een Delta conform de input-delta. Deze delta wordt opgeslagen bij de target node van de Edge.

Tenslotte hebben we de functie applyDeltas van een Node, die pas toegepast wordt als alle supports van de Node gepropageerd hebben. Deze applyDeltas roept applyUpdate aan op de payload, op elke Delta, en slaat die op in de Node. NB: we hebben de keuze om achtereenvolgens alle deltas toe te passen en het resultaat te assignen, en bij elke stap te assignen.


====================================================================================================
Praktische problemen:
1. Ik wil een map van Edges, maar elke Edge mag wijzen naar een ander type node. D.w.z. Node is geparameteriseerd, maar ik wil in Edge niets zeggen over de waarde van die Node, behalve dat ie Updatable moet zijn.