// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Reader_Trans = require("../Control.Monad.Reader.Trans");
var Control_Monad_State = require("../Control.Monad.State");
var Control_Monad_State_Class = require("../Control.Monad.State.Class");
var Control_Monad_State_Trans = require("../Control.Monad.State.Trans");
var Control_Monad_Trans_Class = require("../Control.Monad.Trans.Class");
var Data_Array = require("../Data.Array");
var Data_Eq = require("../Data.Eq");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_Maybe = require("../Data.Maybe");
var Data_Traversable = require("../Data.Traversable");
var Data_Unit = require("../Data.Unit");
var Perspectives_CoreTypes = require("../Perspectives.CoreTypes");
var Perspectives_DataTypeObjectGetters = require("../Perspectives.DataTypeObjectGetters");
var Perspectives_Effects = require("../Perspectives.Effects");
var Perspectives_EntiteitAndRDFAliases = require("../Perspectives.EntiteitAndRDFAliases");
var Perspectives_ObjectsGetterComposition = require("../Perspectives.ObjectsGetterComposition");
var Perspectives_PerspectEntiteit = require("../Perspectives.PerspectEntiteit");
var Perspectives_ResourceRetrieval = require("../Perspectives.ResourceRetrieval");
var Perspectives_Syntax = require("../Perspectives.Syntax");
var Prelude = require("../Prelude");
var saveUserData$prime = function (buitenRollen) {
    var seenBefore = function (id) {
        return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_State_Class.get(Control_Monad_State_Trans.monadStateStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))))(function (ids) {
            return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Maybe.maybe(false)(Data_Function["const"](true))(Data_Array.elemIndex(Data_Eq.eqString)(id)(ids)));
        });
    };
    var isBuitenRol = function (id) {
        return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_CoreTypes.applyObjectsGetterToObject(id)(Perspectives_ObjectsGetterComposition.unionOfObjects(Perspectives_DataTypeObjectGetters.context)(Perspectives_DataTypeObjectGetters.buitenRol))))(function (v) {
            return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(id === v);
        });
    };
    var haveSeen = function (id) {
        return Control_Monad_State_Class.modify(Control_Monad_State_Trans.monadStateStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Array.cons(id));
    };
    var saveContext = function (contextId) {
        return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(seenBefore(contextId))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Unit.unit))(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(haveSeen(contextId))(function () {
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Data_Functor["void"](Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff))(Perspectives_ResourceRetrieval.saveEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitContext)(contextId))))(function () {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_DataTypeObjectGetters.iedereRolInContext(contextId)))(function (v) {
                    return Data_Functor["void"](Control_Monad_State_Trans.functorStateT(Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff)))(Data_Traversable["for"](Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Traversable.traversableArray)(v)(function (rol) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(haveSeen(rol))(function () {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Data_Functor["void"](Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff))(Perspectives_ResourceRetrieval.saveEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitRol)(rol))))(function () {
                                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_CoreTypes.applyObjectsGetterToMaybeObject(rol)(Perspectives_DataTypeObjectGetters.binding)))(function (v1) {
                                    if (v1 instanceof Data_Maybe.Nothing) {
                                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Unit.unit);
                                    };
                                    if (v1 instanceof Data_Maybe.Just) {
                                        return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isBuitenRol(v1.value0))(saveBuitenRol(v1.value0))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Unit.unit));
                                    };
                                    throw new Error("Failed pattern match at Perspectives.SaveUserData line 46, column 11 - line 50, column 26: " + [ v1.constructor.name ]);
                                });
                            });
                        });
                    }));
                });
            });
        }));
    };
    var saveBuitenRol = function (rolId) {
        return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(seenBefore(rolId))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Unit.unit))(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(haveSeen(rolId))(function () {
            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Data_Functor["void"](Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff))(Perspectives_ResourceRetrieval.saveEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitRol)(rolId))))(function () {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_CoreTypes.applyObjectsGetterToObject(rolId)(Perspectives_DataTypeObjectGetters.context)))(saveContext);
            });
        }));
    };
    return Data_Functor["void"](Control_Monad_State_Trans.functorStateT(Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff)))(Data_Traversable["for"](Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Traversable.traversableArray)(buitenRollen)(saveBuitenRol));
};
var saveUserData = function (buitenRollen) {
    return Control_Monad_State_Trans.evalStateT(Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff))(saveUserData$prime(buitenRollen))([  ]);
};
module.exports = {
    saveUserData: saveUserData,
    "saveUserData'": saveUserData$prime
};
