// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_Console = require("../Control.Monad.Aff.Console");
var Control_Monad_Eff_Class = require("../Control.Monad.Eff.Class");
var Control_Monad_Eff_Console = require("../Control.Monad.Eff.Console");
var Control_Monad_Eff_Exception = require("../Control.Monad.Eff.Exception");
var Control_Monad_Error_Class = require("../Control.Monad.Error.Class");
var Control_Monad_Reader_Trans = require("../Control.Monad.Reader.Trans");
var Control_Monad_Trans_Class = require("../Control.Monad.Trans.Class");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var Data_Either = require("../Data.Either");
var Data_Function = require("../Data.Function");
var Data_Maybe = require("../Data.Maybe");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Show = require("../Data.Show");
var Node_Encoding = require("../Node.Encoding");
var Node_FS = require("../Node.FS");
var Node_FS_Sync = require("../Node.FS.Sync");
var Node_Path = require("../Node.Path");
var Perspectives_CollectDomeinFile = require("../Perspectives.CollectDomeinFile");
var Perspectives_ContextRoleParser = require("../Perspectives.ContextRoleParser");
var Perspectives_CoreTypes = require("../Perspectives.CoreTypes");
var Perspectives_DomeinCache = require("../Perspectives.DomeinCache");
var Perspectives_Effects = require("../Perspectives.Effects");
var Perspectives_PerspectEntiteit = require("../Perspectives.PerspectEntiteit");
var Perspectives_Resource = require("../Perspectives.Resource");
var Perspectives_SaveUserData = require("../Perspectives.SaveUserData");
var Perspectives_Syntax = require("../Perspectives.Syntax");
var Prelude = require("../Prelude");
var Text_Parsing_Parser = require("../Text.Parsing.Parser");
var modelDirectory = "/Users/joopringelberg/Code/perspectives-electron-app/src/model";
var test = Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log("=========================Parse a file===================")))(function () {
    return Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Eff_Class.liftEff(Control_Monad_Aff.monadEffAff)(Node_FS_Sync.readTextFile(Node_Encoding.UTF8.value)(Node_Path.concat([ modelDirectory, "systeem.crl" ])))))(function (v) {
        return Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_ContextRoleParser.parseAndCache(v))(function (v1) {
            if (v1 instanceof Data_Either.Right) {
                if (v1.value0 instanceof Perspectives_ContextRoleParser.RootContext) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log("Attempting to save...")))(function () {
                        return Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Control_Monad_Error_Class.catchError(Control_Monad_Reader_Trans.monadErrorReaderT(Control_Monad_Aff.monadErrorAff))(Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_Resource.getPerspectEntiteit(Perspectives_PerspectEntiteit.perspectEntiteitContext)(v1.value0.value0))(function ($17) {
                            return Control_Applicative.pure(Control_Monad_Reader_Trans.applicativeReaderT(Control_Monad_Aff.applicativeAff))(Data_Maybe.Just.create($17));
                        }))(function (v2) {
                            return Control_Applicative.pure(Control_Monad_Reader_Trans.applicativeReaderT(Control_Monad_Aff.applicativeAff))(Data_Maybe.Nothing.value);
                        }))(function (v2) {
                            if (v2 instanceof Data_Maybe.Nothing) {
                                return Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log("Cannot find context " + v1.value0.value0));
                            };
                            if (v2 instanceof Data_Maybe.Just) {
                                return Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_CollectDomeinFile.domeinFileFromContext(v2.value0))(function (v3) {
                                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_DomeinCache.storeDomeinFileInCouchdb(v3))(function () {
                                        return Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log("Saved " + Data_Show.show(Data_Show.showString)(v1.value0.value0)));
                                    });
                                });
                            };
                            throw new Error("Failed pattern match at Test.ParseFiles line 42, column 11 - line 48, column 53: " + [ v2.constructor.name ]);
                        });
                    });
                };
                if (v1.value0 instanceof Perspectives_ContextRoleParser.UserData) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log("Attempting to save...")))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_SaveUserData.saveUserData(v1.value0.value0))(function () {
                            return Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log(Data_Show.show(Data_Show.showArray(Data_Show.showString))(v1.value0.value0)));
                        });
                    });
                };
                throw new Error("Failed pattern match at Test.ParseFiles line 36, column 7 - line 52, column 41: " + [ v1.value0.constructor.name ]);
            };
            if (v1 instanceof Data_Either.Left) {
                return Control_Monad_Trans_Class.lift(Control_Monad_Reader_Trans.monadTransReaderT)(Control_Monad_Aff.monadAff)(Control_Monad_Aff_Console.log(Data_Show.show(Text_Parsing_Parser.showParseError)(v1.value0)));
            };
            throw new Error("Failed pattern match at Test.ParseFiles line 34, column 3 - line 53, column 35: " + [ v1.constructor.name ]);
        });
    });
});
module.exports = {
    modelDirectory: modelDirectory,
    test: test
};
