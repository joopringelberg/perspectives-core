// Generated by purs version 0.11.7
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Apply = require("../Control.Apply");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Eff_Exception = require("../Control.Monad.Eff.Exception");
var Control_Monad_Reader_Trans = require("../Control.Monad.Reader.Trans");
var Control_Monad_State_Trans = require("../Control.Monad.State.Trans");
var Control_Monad_Trans_Class = require("../Control.Monad.Trans.Class");
var Control_Semigroupoid = require("../Control.Semigroupoid");
var Data_Array = require("../Data.Array");
var Data_Either = require("../Data.Either");
var Data_Foldable = require("../Data.Foldable");
var Data_Function = require("../Data.Function");
var Data_Functor = require("../Data.Functor");
var Data_Maybe = require("../Data.Maybe");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Show = require("../Data.Show");
var Data_StrMap = require("../Data.StrMap");
var Data_TraversableWithIndex = require("../Data.TraversableWithIndex");
var Data_Tuple = require("../Data.Tuple");
var Partial_Unsafe = require("../Partial.Unsafe");
var Perpectives_TypeChecker = require("../Perpectives.TypeChecker");
var Perspectives_ContextAndRole = require("../Perspectives.ContextAndRole");
var Perspectives_CoreTypes = require("../Perspectives.CoreTypes");
var Perspectives_DataTypeObjectGetters = require("../Perspectives.DataTypeObjectGetters");
var Perspectives_DataTypeTripleGetters = require("../Perspectives.DataTypeTripleGetters");
var Perspectives_Effects = require("../Perspectives.Effects");
var Perspectives_EntiteitAndRDFAliases = require("../Perspectives.EntiteitAndRDFAliases");
var Perspectives_Identifiers = require("../Perspectives.Identifiers");
var Perspectives_ModelBasedTripleGetters = require("../Perspectives.ModelBasedTripleGetters");
var Perspectives_ObjectGetterConstructors = require("../Perspectives.ObjectGetterConstructors");
var Perspectives_ObjectsGetterComposition = require("../Perspectives.ObjectsGetterComposition");
var Perspectives_PerspectEntiteit = require("../Perspectives.PerspectEntiteit");
var Perspectives_QueryAST = require("../Perspectives.QueryAST");
var Perspectives_RunMonadPerspectivesQuery = require("../Perspectives.RunMonadPerspectivesQuery");
var Perspectives_Syntax = require("../Perspectives.Syntax");
var Perspectives_Utilities = require("../Perspectives.Utilities");
var Prelude = require("../Prelude");
var q = function (ln) {
    return "model:QueryAst$" + ln;
};
var psp = function (ln) {
    return "model:Perspectives$" + ln;
};
var createRol = function (rolName) {
    return function (contextId) {
        return function (bindingValue) {
            return function (i) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_Identifiers.guardWellFormedNess(Control_Monad_State_Trans.monadThrowStateT(Control_Monad_Reader_Trans.monadThrowReaderT(Control_Monad_Aff.monadThrowAff)))(Perspectives_Identifiers.deconstructLocalNameFromDomeinURI)(rolName))(function (v) {
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(contextId + ("$" + (v + Data_Show.show(Data_Show.showInt)(i)))))(function (v1) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_PerspectEntiteit.cacheEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitRol)(v1)((function () {
                            var $74 = {};
                            for (var $75 in Perspectives_ContextAndRole.defaultRolRecord) {
                                if ({}.hasOwnProperty.call(Perspectives_ContextAndRole.defaultRolRecord, $75)) {
                                    $74[$75] = Perspectives_ContextAndRole["defaultRolRecord"][$75];
                                };
                            };
                            $74._id = v1;
                            $74.pspType = rolName;
                            $74.context = contextId;
                            $74.binding = Perspectives_Syntax.binding(bindingValue);
                            return $74;
                        })())))(function () {
                            return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(v1);
                        });
                    });
                });
            };
        };
    };
};
var createContext = function (name) {
    return function (typeId) {
        return function (roles) {
            return function (properties) {
                var createProperty = function (v) {
                    return new Data_Tuple.Tuple(v.value0, {
                        commentBefore: [  ],
                        commentAfter: [  ],
                        value: v.value1
                    });
                };
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_Identifiers.guardWellFormedNess(Control_Monad_State_Trans.monadThrowStateT(Control_Monad_Reader_Trans.monadThrowReaderT(Control_Monad_Aff.monadThrowAff)))(Perspectives_Identifiers.deconstructLocalNameFromDomeinURI)(name))(function (v) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_PerspectEntiteit.cacheEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitContext)(name)((function () {
                        var $84 = {};
                        for (var $85 in Perspectives_ContextAndRole.defaultContextRecord) {
                            if ({}.hasOwnProperty.call(Perspectives_ContextAndRole.defaultContextRecord, $85)) {
                                $84[$85] = Perspectives_ContextAndRole["defaultContextRecord"][$85];
                            };
                        };
                        $84._id = name;
                        $84._rev = Data_Maybe.Nothing.value;
                        $84.displayName = v;
                        $84.pspType = typeId;
                        $84.buitenRol = Perspectives_Identifiers.buitenRol(name);
                        $84.binnenRol = (function () {
                            var $81 = {};
                            for (var $82 in Perspectives_ContextAndRole.defaultRolRecord) {
                                if ({}.hasOwnProperty.call(Perspectives_ContextAndRole.defaultRolRecord, $82)) {
                                    $81[$82] = Perspectives_ContextAndRole["defaultRolRecord"][$82];
                                };
                            };
                            $81._id = Perspectives_Identifiers.binnenRol(name);
                            $81.pspType = typeId + "$binnenRolBeschrijving";
                            $81.binding = Perspectives_Syntax.binding(Perspectives_Identifiers.buitenRol(name));
                            return $81;
                        })();
                        $84.rolInContext = Data_StrMap.fromFoldable(Data_Foldable.foldableArray)(roles);
                        return $84;
                    })())))(function () {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_PerspectEntiteit.cacheEntiteitPreservingVersion(Perspectives_PerspectEntiteit.perspectEntiteitRol)(Perspectives_Identifiers.buitenRol(name))((function () {
                            var $87 = {};
                            for (var $88 in Perspectives_ContextAndRole.defaultRolRecord) {
                                if ({}.hasOwnProperty.call(Perspectives_ContextAndRole.defaultRolRecord, $88)) {
                                    $87[$88] = Perspectives_ContextAndRole["defaultRolRecord"][$88];
                                };
                            };
                            $87._id = Perspectives_Identifiers.buitenRol(name);
                            $87.pspType = typeId + "$buitenRolBeschrijving";
                            $87.context = name;
                            $87.binding = Perspectives_Syntax.binding(Perspectives_Identifiers.buitenRol(typeId));
                            $87.properties = Data_StrMap.fromFoldable(Data_Foldable.foldableArray)(Data_Functor.map(Data_Functor.functorArray)(createProperty)(properties));
                            return $87;
                        })())))(function () {
                            return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Right.create(name));
                        });
                    });
                });
            };
        };
    };
};
var createContextWithExternalProperty = function (contextId) {
    return function (contextType) {
        return function (propVal) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_Utilities.onNothing(Control_Monad_State_Trans.monadThrowStateT(Control_Monad_Reader_Trans.monadThrowReaderT(Control_Monad_Aff.monadThrowAff)))(Control_Monad_Eff_Exception.error("No parameter found for " + contextType))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_ObjectGetterConstructors.getRol("model:Perspectives$Context$buitenenRolBeschrijving$rolProperty")(contextType))(function ($216) {
                return Control_Applicative.pure(Control_Monad_Reader_Trans.applicativeReaderT(Control_Monad_Aff.applicativeAff))(Data_Array.head($216));
            }))))(function (v) {
                return createContext(contextId)(contextType)([  ])([ new Data_Tuple.Tuple(v, [ propVal ]) ]);
            });
        };
    };
};
var createContextWithMultipleRoleInstances = function (contextId) {
    return function (contextType) {
        return function (rolName) {
            return function (bindings) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(function (i) {
                    return function (b) {
                        return createRol(rolName)(contextId)(b)(i);
                    };
                })(Data_Functor.map(Data_Functor.functorArray)(Perspectives_Identifiers.buitenRol)(bindings)))(function (v) {
                    return createContext(contextId)(contextType)(Data_Functor.map(Data_Functor.functorArray)(function ($217) {
                        return Data_Tuple.Tuple.create(rolName)(Data_Array.singleton($217));
                    })(v))([  ]);
                });
            };
        };
    };
};
var createSumType = function (types) {
    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(createContextWithMultipleRoleInstances("")("model:Perspectives$Sum")("model:Perspectives$Sum$alternative")(types))(function (v) {
        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.fromRight()(v));
    });
};
var createContextWithSingleRole = function (contextId) {
    return function (contextType) {
        return function (bindingValue) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_Utilities.onNothing(Control_Monad_State_Trans.monadThrowStateT(Control_Monad_Reader_Trans.monadThrowReaderT(Control_Monad_Aff.monadThrowAff)))(Control_Monad_Eff_Exception.error("No rolType found for " + contextType))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Control_Bind.bind(Control_Monad_Reader_Trans.bindReaderT(Control_Monad_Aff.bindAff))(Perspectives_ObjectsGetterComposition.unionOfObjects(Perspectives_ObjectsGetterComposition.unionOfObjects(Perspectives_ObjectGetterConstructors.getRol("model:Perspectives$Context$rolInContext"))(Perspectives_DataTypeObjectGetters.binding))(Perspectives_DataTypeObjectGetters.context)(contextType))(function ($218) {
                return Control_Applicative.pure(Control_Monad_Reader_Trans.applicativeReaderT(Control_Monad_Aff.applicativeAff))(Data_Array.head($218));
            }))))(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(createRol(v)(contextId)(Perspectives_Identifiers.buitenRol(bindingValue))(0))(function (v1) {
                    return createContext(contextId)(contextType)([ new Data_Tuple.Tuple(v, [ v1 ]) ])([  ]);
                });
            });
        };
    };
};
var createDataTypeGetterDescription = function (contextId) {
    return function (functionName) {
        return createContext(contextId)(q("DataTypeGetter"))([  ])([ new Data_Tuple.Tuple(q("DataTypeGetter$buitenRolBeschrijvingfunctionName"), [ functionName ]) ]);
    };
};
var createPropertyGetterDescription = function (contextId) {
    return function (functionName) {
        return function (propertyName) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(createRol(q("PropertyGetter$property"))(contextId)(Perspectives_Identifiers.buitenRol(propertyName))(0))(function (v) {
                return createContext(contextId)(q("PropertyGetter"))([ new Data_Tuple.Tuple(q("PropertyGetter$property"), [ v ]) ])([ new Data_Tuple.Tuple(q("PropertyGetter$buitenRolBeschrijving$functionName"), [ functionName ]) ]);
            });
        };
    };
};
var createRolGetterDescription = function (contextId) {
    return function (functionName) {
        return function (rolName) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(createRol(q("RolGetter$rol"))(contextId)(Perspectives_Identifiers.buitenRol(rolName))(0))(function (v) {
                return createContext(contextId)(q("RolGetter"))([ new Data_Tuple.Tuple(q("RolGetter$rol"), [ v ]) ])([ new Data_Tuple.Tuple(q("RolGetter$buitenRolBeschrijving$functionName"), [ functionName ]) ]);
            });
        };
    };
};
var compileElementaryQueryStep = function (s) {
    return function (contextId) {
        var thenPutQueryStepDomain = function (m) {
            return function (dom) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(m)(function (v) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(dom))(function () {
                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(v);
                    });
                });
            };
        };
        var isInQueryStepDomain = function (id) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_Identifiers.isInNamespace(id)(v));
            });
        };
        var qualifiedRol = function (rn) {
            return thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(rn)("model:QueryAst$ComputedRolGetter")))(function (v) {
                if (v) {
                    return createRolGetterDescription(contextId)("computedRolGetter")(rn);
                };
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(rn)("model:Perspectives$Function")))(function (v1) {
                    if (v1) {
                        return createRolGetterDescription(contextId)("rolQuery")(rn);
                    };
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(rn))(function (v2) {
                        if (v2) {
                            return createRolGetterDescription(contextId)("constructRolGetter")(rn);
                        };
                        return createRolGetterDescription(contextId)("constructRolLookup")(rn);
                    });
                });
            }))(rn);
        };
        var ensureRolHasProperty = function (rolId) {
            return function (propertyId) {
                return function (mv) {
                    return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkRolForQualifiedProperty(propertyId)(rolId)))(mv)(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.MissingQualifiedProperty(propertyId, rolId))));
                };
            };
        };
        var ensureContextHasRol = function (contextId$prime) {
            return function (rolId) {
                return function (mv) {
                    return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkContextForQualifiedRol(rolId)(contextId$prime)))(mv)(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.MissingQualifiedRol(rolId, contextId$prime))));
                };
            };
        };
        var ensureAspect = function (aspect) {
            return function (mv) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                    return Control_Bind.ifM(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.isOrHasAspect(v)(aspect)))(mv)(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.MissingAspect(v, aspect))));
                });
            };
        };
        if (s instanceof Perspectives_QueryAST.Constant) {
            return Control_Apply.applySecond(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(s.value0))(createContextWithExternalProperty(contextId)(q("constant"))(s.value1));
        };
        if (s instanceof Perspectives_QueryAST.Variable) {
            return Perspectives_Utilities.ifNothing(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryVariableType(s.value0))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.MissingVariableDeclaration(s.value0))))(function (tp) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(tp))(function () {
                    return createContextWithExternalProperty(contextId)(q("variable"))(s.value0);
                });
            });
        };
        if (s instanceof Perspectives_QueryAST.RolesOf) {
            return ensureAspect(psp("Context"))(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(psp("Rol")))(function () {
                return createContextWithSingleRole(contextId)(q("rolesOf"))(s.value0);
            }));
        };
        if (s instanceof Perspectives_QueryAST.Binding) {
            return ensureAspect(psp("Rol"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Perspectives_Utilities.ifNothing(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_RunMonadPerspectivesQuery.runTypedTripleGetterToMaybeObject(v)(Perspectives_ModelBasedTripleGetters.bindingDefM)))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.MissingMogelijkeBinding(v))))(function (bindingType) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(bindingType))(function () {
                        return createDataTypeGetterDescription(contextId)("binding");
                    });
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.Context) {
            return ensureAspect(psp("Rol"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(Data_Maybe.fromJust()(Perspectives_Identifiers.deconstructLocalNameFromDomeinURI(v))))(function () {
                    return createDataTypeGetterDescription(contextId)("context");
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.Identity) {
            return createDataTypeGetterDescription(contextId)("identityM");
        };
        if (s instanceof Perspectives_QueryAST.Type) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.isOrHasAspect(v)(psp("Context"))))(function (v1) {
                    if (v1) {
                        return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_RunMonadPerspectivesQuery.runTypedTripleGetterToObject(v)(Perspectives_DataTypeTripleGetters.contextTypeM)))(Perspectives_CoreTypes.putQueryStepDomain))(function (v2) {
                            return createDataTypeGetterDescription(contextId)("contextTypeM");
                        });
                    };
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_RunMonadPerspectivesQuery.runTypedTripleGetterToObject(v)(Perspectives_DataTypeTripleGetters.contextTypeM)))(Perspectives_CoreTypes.putQueryStepDomain))(function (v2) {
                        return createDataTypeGetterDescription(contextId)("rolType");
                    });
                });
            });
        };
        if (s instanceof Perspectives_QueryAST.BuitenRol) {
            return ensureAspect(psp("Context"))(Control_Apply.applySecond(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(psp("Rol")))(createDataTypeGetterDescription(contextId)("buitenRol")));
        };
        if (s instanceof Perspectives_QueryAST.IedereRolInContext) {
            return ensureAspect(psp("Context"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_RunMonadPerspectivesQuery.runTypedTripleGetterToObjects(v)(Perspectives_ModelBasedTripleGetters.ownRollenDefM)))(function (v1) {
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(createSumType(v1))(function (v2) {
                        return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(v2))(function () {
                            return createDataTypeGetterDescription(contextId)("iedereRolInContext");
                        });
                    });
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.RolTypen) {
            return ensureAspect(psp("Context"))(Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function ($219) {
                return Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perspectives_RunMonadPerspectivesQuery.runTypedTripleGetter(Perspectives_ModelBasedTripleGetters.ownRollenDefM)($219));
            }))(function ($220) {
                return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.tripleObjects($220));
            }))(function ($221) {
                return Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.mostSpecificCommonAspect($221));
            }))(Perspectives_CoreTypes.putQueryStepDomain))(function () {
                return createDataTypeGetterDescription(contextId)("typeVanIedereRolInContext");
            }));
        };
        if (s instanceof Perspectives_QueryAST.Label) {
            return ensureAspect(psp("Context"))(Control_Apply.applySecond(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(psp("String")))(createDataTypeGetterDescription(contextId)("label")));
        };
        if (s instanceof Perspectives_QueryAST.QualifiedProperty) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return ensureRolHasProperty(v)(s.value0)(thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(s.value0)("model:Perspectives$Function")))(function (v1) {
                    if (v1) {
                        return createContextWithSingleRole(contextId)(q("propertyQuery"))(s.value0);
                    };
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(s.value0))(function (v2) {
                        if (v2) {
                            return createPropertyGetterDescription(contextId)("constructRolPropertyGetter")(s.value0);
                        };
                        return createPropertyGetterDescription(contextId)("constructRolPropertyLookup")(s.value0);
                    });
                }))(s.value0));
            });
        };
        if (s instanceof Perspectives_QueryAST.QualifiedInternalProperty) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return ensureRolHasProperty(v)(s.value0)(thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(s.value0)("model:Perspectives$Function")))(function (v1) {
                    if (v1) {
                        return createContextWithSingleRole(contextId)(q("propertyQuery"))(s.value0);
                    };
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(s.value0))(function (v2) {
                        if (v2) {
                            return createPropertyGetterDescription(contextId)("constructInternalPropertyGetter")(s.value0);
                        };
                        return createPropertyGetterDescription(contextId)("constructInternalPropertyLookup")(s.value0);
                    });
                }))(s.value0));
            });
        };
        if (s instanceof Perspectives_QueryAST.QualifiedExternalProperty) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return ensureRolHasProperty(v)(s.value0)(thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(s.value0)("model:Perspectives$Function")))(function (v1) {
                    if (v1) {
                        return createContextWithSingleRole(contextId)(q("propertyQuery"))(s.value0);
                    };
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(s.value0))(function (v2) {
                        if (v2) {
                            return createPropertyGetterDescription(contextId)("constructExternalPropertyGetter")(s.value0);
                        };
                        return createPropertyGetterDescription(contextId)("constructExternalPropertyLookup")(s.value0);
                    });
                }))(s.value0));
            });
        };
        if (s instanceof Perspectives_QueryAST.UnqualifiedProperty) {
            return ensureAspect(psp("Rol"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkRolForUnQualifiedProperty(s.value0)(v)))(function (v1) {
                    if (v1 instanceof Data_Either.Left) {
                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v1.value0));
                    };
                    if (v1 instanceof Data_Either.Right) {
                        var qn = v1.value0 + ("$" + s.value0);
                        return thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(qn)("model:Perspectives$Function")))(function (v2) {
                            if (v2) {
                                return createPropertyGetterDescription(contextId)("propertyQuery")(qn);
                            };
                            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(v1.value0))(function (v3) {
                                if (v3) {
                                    return createPropertyGetterDescription(contextId)("constructRolPropertyGetter")(qn);
                                };
                                return createPropertyGetterDescription(contextId)("constructRolPropertyLookup")(qn);
                            });
                        }))(qn);
                    };
                    throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 134, column 7 - line 147, column 40: " + [ v1.constructor.name ]);
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.UnqualifiedInternalProperty) {
            return ensureAspect(psp("Rol"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkRolForUnQualifiedProperty(s.value0)(v)))(function (v1) {
                    if (v1 instanceof Data_Either.Left) {
                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v1.value0));
                    };
                    if (v1 instanceof Data_Either.Right) {
                        var qn = v1.value0 + ("$" + s.value0);
                        return thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(qn)("model:Perspectives$Function")))(function (v2) {
                            if (v2) {
                                return createPropertyGetterDescription(contextId)("propertyQuery")(qn);
                            };
                            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(qn))(function (v3) {
                                if (v3) {
                                    return createPropertyGetterDescription(contextId)("constructInternalPropertyGetter")(qn);
                                };
                                return createPropertyGetterDescription(contextId)("constructInternalPropertyLookup")(qn);
                            });
                        }))(qn);
                    };
                    throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 152, column 7 - line 165, column 41: " + [ v1.constructor.name ]);
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.UnqualifiedExternalProperty) {
            return ensureAspect(psp("Rol"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkRolForUnQualifiedProperty(s.value0)(v)))(function (v1) {
                    if (v1 instanceof Data_Either.Left) {
                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v1.value0));
                    };
                    if (v1 instanceof Data_Either.Right) {
                        var qn = v1.value0 + ("$" + s.value0);
                        return thenPutQueryStepDomain(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.contextHasType(qn)("model:Perspectives$Function")))(function (v2) {
                            if (v2) {
                                return createPropertyGetterDescription(contextId)("propertyQuery")(qn);
                            };
                            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(isInQueryStepDomain(qn))(function (v3) {
                                if (v3) {
                                    return createPropertyGetterDescription(contextId)("constructExternalPropertyGetter")(qn);
                                };
                                return createPropertyGetterDescription(contextId)("constructExternalPropertyLookup")(qn);
                            });
                        }))(qn);
                    };
                    throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 170, column 7 - line 183, column 41: " + [ v1.constructor.name ]);
                });
            }));
        };
        if (s instanceof Perspectives_QueryAST.QualifiedRol) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return ensureContextHasRol(v)(s.value0)(qualifiedRol(s.value0));
            });
        };
        if (s instanceof Perspectives_QueryAST.UnqualifiedRol) {
            return ensureAspect(psp("Context"))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryStepDomain)(function (v) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.checkContextForUnQualifiedRol(s.value0)(v)))(function (v1) {
                    if (v1 instanceof Data_Either.Left) {
                        return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v1.value0));
                    };
                    if (v1 instanceof Data_Either.Right) {
                        var qn = v1.value0 + ("$" + s.value0);
                        return qualifiedRol(qn);
                    };
                    throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 192, column 7 - line 196, column 28: " + [ v1.constructor.name ]);
                });
            }));
        };
        throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 35, column 42 - line 196, column 28: " + [ s.constructor.name ]);
    };
};
var compileCombinatorQueryStep = function (s) {
    return function (contextId) {
        var whenRight = function (dictMonad) {
            return function (m) {
                return function (f) {
                    return Control_Bind.bind(dictMonad.Bind1())(m)(function (v) {
                        if (v instanceof Data_Either.Left) {
                            return Control_Applicative.pure(dictMonad.Applicative0())(new Data_Either.Left(v.value0));
                        };
                        if (v instanceof Data_Either.Right) {
                            return f(v.value0);
                        };
                        throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 328, column 7 - line 330, column 25: " + [ v.constructor.name ]);
                    });
                };
            };
        };
        var compileUnaryStep = function (qs) {
            return function (combinatorLocalName) {
                return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(qs)(contextId + ("$" + combinatorLocalName)))(Data_Either.either(function ($222) {
                    return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create($222));
                })(createContextWithSingleRole(contextId)(q(combinatorLocalName))));
            };
        };
        var compileOperand = function (localName) {
            return function (i) {
                return function (qs) {
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(contextId + (localName + Data_Show.show(Data_Show.showInt)(i))))(function (v) {
                        return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(qs)(v))(function (v1) {
                            if (v1 instanceof Data_Either.Left) {
                                return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v1.value0));
                            };
                            if (v1 instanceof Data_Either.Right) {
                                return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Right(new Data_Tuple.Tuple(v, [ v1.value0 ])));
                            };
                            throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 318, column 9 - line 320, column 53: " + [ v1.constructor.name ]);
                        });
                    });
                };
            };
        };
        if (s instanceof Perspectives_QueryAST.Filter) {
            return whenRight(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(s.value0)(contextId + "$criterium"))(function (criterium) {
                return whenRight(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(s.value1)(contextId + "$candidates"))(function (candidates) {
                    return createContext(contextId)(q("filter"))([ new Data_Tuple.Tuple(q("filter$criterium"), [ criterium ]), new Data_Tuple.Tuple(q("filter$candidates"), [ candidates ]) ])([  ]);
                });
            });
        };
        if (s instanceof Perspectives_QueryAST.Concat) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileOperand("$concat"))(s.value0))(function (v) {
                var v1 = Data_Foldable.find(Data_Foldable.foldableArray)(Data_Either.isLeft)(v);
                if (v1 instanceof Data_Maybe.Nothing) {
                    return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Functor.map(Data_Functor.functorArray)(Data_Either.fromRight())(v)))(function (v2) {
                        return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Functor.map(Data_Functor.functorArray)(function ($223) {
                            return Data_Maybe.fromJust()(Data_Array.head(Data_Tuple.snd($223)));
                        })(v2)))(function (v3) {
                            return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Control_Monad_Trans_Class.lift(Control_Monad_State_Trans.monadTransStateT)(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff))(Perpectives_TypeChecker.mostSpecificCommonAspect(v3)))(Perspectives_CoreTypes.putQueryStepDomain))(function () {
                                return createContext(contextId)(q("concat"))(v2)([  ]);
                            });
                        });
                    });
                };
                if (v1 instanceof Data_Maybe.Just) {
                    return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(Data_Either.fromLeft()(v1.value0)));
                };
                throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 267, column 5 - line 273, column 59: " + [ v1.constructor.name ]);
            });
        };
        if (s instanceof Perspectives_QueryAST.Compose) {
            return Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_TraversableWithIndex.traverseWithIndex(Data_TraversableWithIndex.traversableWithIndexArray)(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileOperand("$compose"))(s.value0))(function (v) {
                var v1 = Data_Foldable.find(Data_Foldable.foldableArray)(Data_Either.isLeft)(v);
                if (v1 instanceof Data_Maybe.Nothing) {
                    return createContext(contextId)(q("compose"))(Data_Functor.map(Data_Functor.functorArray)(Data_Either.fromRight())(v))([  ]);
                };
                if (v1 instanceof Data_Maybe.Just) {
                    return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(Data_Either.fromLeft()(v1.value0)));
                };
                throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 276, column 5 - line 278, column 59: " + [ v1.constructor.name ]);
            });
        };
        if (s instanceof Perspectives_QueryAST.NotEmpty) {
            return Control_Apply.applySecond(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(psp("Boolean")))(compileUnaryStep(s.value0)("notEmpty"));
        };
        if (s instanceof Perspectives_QueryAST.Closure) {
            return compileUnaryStep(s.value0)("closure");
        };
        if (s instanceof Perspectives_QueryAST["Closure'"]) {
            return compileUnaryStep(s.value0)("closure'");
        };
        if (s instanceof Perspectives_QueryAST.UseCache) {
            return compileUnaryStep(s.value0)("UseCache");
        };
        if (s instanceof Perspectives_QueryAST.IgnoreCache) {
            return compileUnaryStep(s.value0)("IgnoreCache'");
        };
        if (s instanceof Perspectives_QueryAST.LastElement) {
            return compileUnaryStep(s.value0)("laatste");
        };
        if (s instanceof Perspectives_QueryAST.Contains) {
            return whenRight(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(s.value0)(contextId + "$valueOrId"))(function (value) {
                return whenRight(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(compileCombinatorQueryStep(s.value1)(contextId + "$query"))(function (query) {
                    return Control_Apply.applySecond(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryStepDomain(psp("Boolean")))(createContext(contextId)(q("contains"))([ new Data_Tuple.Tuple(q("contains$valueOrId"), [ value ]), new Data_Tuple.Tuple(q("contains$query"), [ query ]) ])([  ]));
                });
            });
        };
        if (s instanceof Perspectives_QueryAST.SetVariable) {
            return Perspectives_Utilities.ifNothing(Control_Monad_State_Trans.monadStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.getQueryVariableType(s.value0))(Control_Bind.bind(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.withQueryCompilerEnvironment(Control_Apply.apply(Control_Monad_State_Trans.applyStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Functor.map(Control_Monad_State_Trans.functorStateT(Control_Monad_Reader_Trans.functorReaderT(Control_Monad_Aff.functorAff)))(Data_Tuple.Tuple.create)(compileCombinatorQueryStep(s.value1)(contextId + "$value")))(Perspectives_CoreTypes.getQueryStepDomain)))(function (v) {
                if (v.value0 instanceof Data_Either.Left) {
                    return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(new Data_Either.Left(v.value0.value0));
                };
                if (v.value0 instanceof Data_Either.Right) {
                    return Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_State_Trans.bindStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Perspectives_CoreTypes.putQueryVariableType(contextId)(v.value1))(function () {
                        return createContext(contextId)(q("setVariable"))([ new Data_Tuple.Tuple(q("setVariable$value"), [ v.value0.value0 ]) ])([ new Data_Tuple.Tuple(q("setVariable$name"), [ s.value0 ]) ]);
                    });
                };
                throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 292, column 7 - line 297, column 49: " + [ v.value0.constructor.name ]);
            }))(function (t) {
                return Control_Applicative.pure(Control_Monad_State_Trans.applicativeStateT(Control_Monad_Reader_Trans.monadReaderT(Control_Monad_Aff.monadAff)))(Data_Either.Left.create(new Perspectives_CoreTypes.VariableAlreadyDeclaredAs(s.value0, t)));
            });
        };
        if (s instanceof Perspectives_QueryAST.Terminal) {
            return compileElementaryQueryStep(s.value0)(contextId);
        };
        throw new Error("Failed pattern match at Perspectives.QueryFunctionDescriptionCompiler line 261, column 42 - line 300, column 57: " + [ s.constructor.name ]);
    };
};
module.exports = {
    compileElementaryQueryStep: compileElementaryQueryStep,
    compileCombinatorQueryStep: compileCombinatorQueryStep,
    q: q,
    psp: psp,
    createContextWithSingleRole: createContextWithSingleRole,
    createContextWithMultipleRoleInstances: createContextWithMultipleRoleInstances,
    createSumType: createSumType,
    createContextWithExternalProperty: createContextWithExternalProperty,
    createDataTypeGetterDescription: createDataTypeGetterDescription,
    createPropertyGetterDescription: createPropertyGetterDescription,
    createRolGetterDescription: createRolGetterDescription,
    createRol: createRol,
    createContext: createContext
};
